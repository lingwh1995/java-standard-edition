package org.bluebridge.utils;

import cn.hutool.core.io.FileUtil;
import cn.hutool.core.util.ArrayUtil;
import cn.hutool.core.util.HexUtil;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;

import java.awt.*;
import java.awt.geom.AffineTransform;
import java.awt.image.AffineTransformOp;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.attribute.PosixFilePermission;
import java.nio.file.attribute.UserPrincipal;
import java.nio.file.attribute.UserPrincipalLookupService;
import java.util.Arrays;
import java.util.EnumSet;
import java.util.Set;
import java.util.stream.IntStream;

/**
 * 还原表端二进制数据为图片流程：
 *  1.先zip解压 压缩以后的字节数组
 *  2.将解压后的字节数组（1000字节） 按200字节一组，分为五组
 *  3.将200字节还原成1600字节
 *  4.加上bmp头+1600字节输出为bmp文件
 */
@Slf4j
public class ImageUtil {

    /**
     * bmp图片的头
     */
    private static final int[] BMP_IMAGE_HEADER_1 = { 0x42, 0x4d, 0x76, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x36, 0x04, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x01, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x02, 0x02, 0x02, 0x00, 0x03, 0x03, 0x03, 0x00, 0x04, 0x04, 0x04, 0x00, 0x05, 0x05, 0x05, 0x00, 0x06, 0x06, 0x06, 0x00, 0x07, 0x07, 0x07, 0x00, 0x08, 0x08, 0x08, 0x00, 0x09, 0x09, 0x09, 0x00, 0x0a, 0x0a, 0x0a, 0x00, 0x0b, 0x0b, 0x0b, 0x00, 0x0c, 0x0c, 0x0c, 0x00, 0x0d, 0x0d, 0x0d, 0x00, 0x0e, 0x0e, 0x0e, 0x00, 0x0f, 0x0f, 0x0f, 0x00, 0x10, 0x10, 0x10, 0x00, 0x11, 0x11, 0x11, 0x00, 0x12, 0x12, 0x12, 0x00, 0x13, 0x13, 0x13, 0x00, 0x14, 0x14, 0x14, 0x00, 0x15, 0x15, 0x15, 0x00, 0x16, 0x16, 0x16, 0x00, 0x17, 0x17, 0x17, 0x00, 0x18, 0x18, 0x18, 0x00, 0x19, 0x19, 0x19, 0x00, 0x1a, 0x1a, 0x1a, 0x00, 0x1b, 0x1b, 0x1b, 0x00, 0x1c, 0x1c, 0x1c, 0x00, 0x1d, 0x1d, 0x1d, 0x00, 0x1e, 0x1e, 0x1e, 0x00, 0x1f, 0x1f, 0x1f, 0x00, 0x20, 0x20, 0x20, 0x00, 0x21, 0x21, 0x21, 0x00, 0x22, 0x22, 0x22, 0x00, 0x23, 0x23, 0x23, 0x00, 0x24, 0x24, 0x24, 0x00, 0x25, 0x25, 0x25, 0x00, 0x26, 0x26, 0x26, 0x00, 0x27, 0x27, 0x27, 0x00, 0x28, 0x28, 0x28, 0x00, 0x29, 0x29, 0x29, 0x00, 0x2a, 0x2a, 0x2a, 0x00, 0x2b, 0x2b, 0x2b, 0x00, 0x2c, 0x2c, 0x2c, 0x00, 0x2d, 0x2d, 0x2d, 0x00, 0x2e, 0x2e, 0x2e, 0x00, 0x2f, 0x2f, 0x2f, 0x00, 0x30, 0x30, 0x30, 0x00, 0x31, 0x31, 0x31, 0x00, 0x32, 0x32, 0x32, 0x00, 0x33, 0x33, 0x33, 0x00, 0x34, 0x34, 0x34, 0x00, 0x35, 0x35, 0x35, 0x00, 0x36, 0x36, 0x36, 0x00, 0x37, 0x37, 0x37, 0x00, 0x38, 0x38, 0x38, 0x00, 0x39, 0x39, 0x39, 0x00, 0x3a, 0x3a, 0x3a, 0x00, 0x3b, 0x3b, 0x3b, 0x00, 0x3c, 0x3c, 0x3c, 0x00, 0x3d, 0x3d, 0x3d, 0x00, 0x3e, 0x3e, 0x3e, 0x00, 0x3f, 0x3f, 0x3f, 0x00, 0x40, 0x40, 0x40, 0x00, 0x41, 0x41, 0x41, 0x00, 0x42, 0x42, 0x42, 0x00, 0x43, 0x43, 0x43, 0x00, 0x44, 0x44, 0x44, 0x00, 0x45, 0x45, 0x45, 0x00, 0x46, 0x46, 0x46, 0x00, 0x47, 0x47, 0x47, 0x00, 0x48, 0x48, 0x48, 0x00, 0x49, 0x49, 0x49, 0x00, 0x4a, 0x4a, 0x4a, 0x00, 0x4b, 0x4b, 0x4b, 0x00, 0x4c, 0x4c, 0x4c, 0x00, 0x4d, 0x4d, 0x4d, 0x00, 0x4e, 0x4e, 0x4e, 0x00, 0x4f, 0x4f, 0x4f, 0x00, 0x50, 0x50, 0x50, 0x00, 0x51, 0x51, 0x51, 0x00, 0x52, 0x52, 0x52, 0x00, 0x53, 0x53, 0x53, 0x00, 0x54, 0x54, 0x54, 0x00, 0x55, 0x55, 0x55, 0x00, 0x56, 0x56, 0x56, 0x00, 0x57, 0x57, 0x57, 0x00, 0x58, 0x58, 0x58, 0x00, 0x59, 0x59, 0x59, 0x00, 0x5a, 0x5a, 0x5a, 0x00, 0x5b, 0x5b, 0x5b, 0x00, 0x5c, 0x5c, 0x5c, 0x00, 0x5d, 0x5d, 0x5d, 0x00, 0x5e, 0x5e, 0x5e, 0x00, 0x5f, 0x5f, 0x5f, 0x00, 0x60, 0x60, 0x60, 0x00, 0x61, 0x61, 0x61, 0x00, 0x62, 0x62, 0x62, 0x00, 0x63, 0x63, 0x63, 0x00, 0x64, 0x64, 0x64, 0x00, 0x65, 0x65, 0x65, 0x00, 0x66, 0x66, 0x66, 0x00, 0x67, 0x67, 0x67, 0x00, 0x68, 0x68, 0x68, 0x00, 0x69, 0x69, 0x69, 0x00, 0x6a, 0x6a, 0x6a, 0x00, 0x6b, 0x6b, 0x6b, 0x00, 0x6c, 0x6c, 0x6c, 0x00, 0x6d, 0x6d, 0x6d, 0x00, 0x6e, 0x6e, 0x6e, 0x00, 0x6f, 0x6f, 0x6f, 0x00, 0x70, 0x70, 0x70, 0x00, 0x71, 0x71, 0x71, 0x00, 0x72, 0x72, 0x72, 0x00, 0x73, 0x73, 0x73, 0x00, 0x74, 0x74, 0x74, 0x00, 0x75, 0x75, 0x75, 0x00, 0x76, 0x76, 0x76, 0x00, 0x77, 0x77, 0x77, 0x00, 0x78, 0x78, 0x78, 0x00, 0x79, 0x79, 0x79, 0x00, 0x7a, 0x7a, 0x7a, 0x00, 0x7b, 0x7b, 0x7b, 0x00, 0x7c, 0x7c, 0x7c, 0x00, 0x7d, 0x7d, 0x7d, 0x00, 0x7e, 0x7e, 0x7e, 0x00, 0x7f, 0x7f, 0x7f, 0x00, 0x80, 0x80, 0x80, 0x00, 0x81, 0x81, 0x81, 0x00, 0x82, 0x82, 0x82, 0x00, 0x83, 0x83, 0x83, 0x00, 0x84, 0x84, 0x84, 0x00, 0x85, 0x85, 0x85, 0x00, 0x86, 0x86, 0x86, 0x00, 0x87, 0x87, 0x87, 0x00, 0x88, 0x88, 0x88, 0x00, 0x89, 0x89, 0x89, 0x00, 0x8a, 0x8a, 0x8a, 0x00, 0x8b, 0x8b, 0x8b, 0x00, 0x8c, 0x8c, 0x8c, 0x00, 0x8d, 0x8d, 0x8d, 0x00, 0x8e, 0x8e, 0x8e, 0x00, 0x8f, 0x8f, 0x8f, 0x00, 0x90, 0x90, 0x90, 0x00, 0x91, 0x91, 0x91, 0x00, 0x92, 0x92, 0x92, 0x00, 0x93, 0x93, 0x93, 0x00, 0x94, 0x94, 0x94, 0x00, 0x95, 0x95, 0x95, 0x00, 0x96, 0x96, 0x96, 0x00, 0x97, 0x97, 0x97, 0x00, 0x98, 0x98, 0x98, 0x00, 0x99, 0x99, 0x99, 0x00, 0x9a, 0x9a, 0x9a, 0x00, 0x9b, 0x9b, 0x9b, 0x00, 0x9c, 0x9c, 0x9c, 0x00, 0x9d, 0x9d, 0x9d, 0x00, 0x9e, 0x9e, 0x9e, 0x00, 0x9f, 0x9f, 0x9f, 0x00, 0xa0, 0xa0, 0xa0, 0x00, 0xa1, 0xa1, 0xa1, 0x00, 0xa2, 0xa2, 0xa2, 0x00, 0xa3, 0xa3, 0xa3, 0x00, 0xa4, 0xa4, 0xa4, 0x00, 0xa5, 0xa5, 0xa5, 0x00, 0xa6, 0xa6, 0xa6, 0x00, 0xa7, 0xa7, 0xa7, 0x00, 0xa8, 0xa8, 0xa8, 0x00, 0xa9, 0xa9, 0xa9, 0x00, 0xaa, 0xaa, 0xaa, 0x00, 0xab, 0xab, 0xab, 0x00, 0xac, 0xac, 0xac, 0x00, 0xad, 0xad, 0xad, 0x00, 0xae, 0xae, 0xae, 0x00, 0xaf, 0xaf, 0xaf, 0x00, 0xb0, 0xb0, 0xb0, 0x00, 0xb1, 0xb1, 0xb1, 0x00, 0xb2, 0xb2, 0xb2, 0x00, 0xb3, 0xb3, 0xb3, 0x00, 0xb4, 0xb4, 0xb4, 0x00, 0xb5, 0xb5, 0xb5, 0x00, 0xb6, 0xb6, 0xb6, 0x00, 0xb7, 0xb7, 0xb7, 0x00, 0xb8, 0xb8, 0xb8, 0x00, 0xb9, 0xb9, 0xb9, 0x00, 0xba, 0xba, 0xba, 0x00, 0xbb, 0xbb, 0xbb, 0x00, 0xbc, 0xbc, 0xbc, 0x00, 0xbd, 0xbd, 0xbd, 0x00, 0xbe, 0xbe, 0xbe, 0x00, 0xbf, 0xbf, 0xbf, 0x00, 0xc0, 0xc0, 0xc0, 0x00, 0xc1, 0xc1, 0xc1, 0x00, 0xc2, 0xc2, 0xc2, 0x00, 0xc3, 0xc3, 0xc3, 0x00, 0xc4, 0xc4, 0xc4, 0x00, 0xc5, 0xc5, 0xc5, 0x00, 0xc6, 0xc6, 0xc6, 0x00, 0xc7, 0xc7, 0xc7, 0x00, 0xc8, 0xc8, 0xc8, 0x00, 0xc9, 0xc9, 0xc9, 0x00, 0xca, 0xca, 0xca, 0x00, 0xcb, 0xcb, 0xcb, 0x00, 0xcc, 0xcc, 0xcc, 0x00, 0xcd, 0xcd, 0xcd, 0x00, 0xce, 0xce, 0xce, 0x00, 0xcf, 0xcf, 0xcf, 0x00, 0xd0, 0xd0, 0xd0, 0x00, 0xd1, 0xd1, 0xd1, 0x00, 0xd2, 0xd2, 0xd2, 0x00, 0xd3, 0xd3, 0xd3, 0x00, 0xd4, 0xd4, 0xd4, 0x00, 0xd5, 0xd5, 0xd5, 0x00, 0xd6, 0xd6, 0xd6, 0x00, 0xd7, 0xd7, 0xd7, 0x00, 0xd8, 0xd8, 0xd8, 0x00, 0xd9, 0xd9, 0xd9, 0x00, 0xda, 0xda, 0xda, 0x00, 0xdb, 0xdb, 0xdb, 0x00, 0xdc, 0xdc, 0xdc, 0x00, 0xdd, 0xdd, 0xdd, 0x00, 0xde, 0xde, 0xde, 0x00, 0xdf, 0xdf, 0xdf, 0x00, 0xe0, 0xe0, 0xe0, 0x00, 0xe1, 0xe1, 0xe1, 0x00, 0xe2, 0xe2, 0xe2, 0x00, 0xe3, 0xe3, 0xe3, 0x00, 0xe4, 0xe4, 0xe4, 0x00, 0xe5, 0xe5, 0xe5, 0x00, 0xe6, 0xe6, 0xe6, 0x00, 0xe7, 0xe7, 0xe7, 0x00, 0xe8, 0xe8, 0xe8, 0x00, 0xe9, 0xe9, 0xe9, 0x00, 0xea, 0xea, 0xea, 0x00, 0xeb, 0xeb, 0xeb, 0x00, 0xec, 0xec, 0xec, 0x00, 0xed, 0xed, 0xed, 0x00, 0xee, 0xee, 0xee, 0x00, 0xef, 0xef, 0xef, 0x00, 0xf0, 0xf0, 0xf0, 0x00, 0xf1, 0xf1, 0xf1, 0x00, 0xf2, 0xf2, 0xf2, 0x00, 0xf3, 0xf3, 0xf3, 0x00, 0xf4, 0xf4, 0xf4, 0x00, 0xf5, 0xf5, 0xf5, 0x00, 0xf6, 0xf6, 0xf6, 0x00, 0xf7, 0xf7, 0xf7, 0x00, 0xf8, 0xf8, 0xf8, 0x00, 0xf9, 0xf9, 0xf9, 0x00, 0xfa, 0xfa, 0xfa, 0x00, 0xfb, 0xfb, 0xfb, 0x00, 0xfc, 0xfc, 0xfc, 0x00, 0xfd, 0xfd, 0xfd, 0x00, 0xfe, 0xfe, 0xfe, 0x00, 0xff, 0xff, 0xff, 0x00 };

    /**
     * 把一个byte转换为8个bits，并且把这8个bits放入到一个数组中
     * @param b
     * @return
     */
//    private static byte[] transByteToBitsArray(byte b) {
//        StringBuilder binaryString = new StringBuilder();
//        for (int i = 7; i >= 0; i--) {
//            binaryString.append((b >> i) & 1);
//        }
//        byte[] target = new byte[8];
//        IntStream.range(0, 8).forEach(i ->  {
//            target[i] = (byte) Integer.parseInt(binaryString.substring(i, i + 1)) == 1 ? (byte)255 : 0;
//        });
//        return target;
//    }
    private static byte[] transByteToBitsArray(byte b) {
        StringBuilder binaryString = new StringBuilder();
        for (int i = 7; i >= 0; i--) {
            binaryString.append((b >> i) & 1);
        }
        byte[] target = new byte[8];
        IntStream.range(0, 8).forEach(i ->  {
            // 使用纯黑(0)和纯白(255)获得更好的浏览器兼容性
            target[i] = (byte) Integer.parseInt(binaryString.substring(i, i + 1)) == 1 ? (byte)255 : (byte)0;
        });
        return target;
    }
    private static byte[] transImageBitsToBytes_1(byte[] src) {
        byte[] des = new byte[1600];
        for (int i = 0; i < 200; i++) {
            byte[] trans = transByteToBitsArray(src[i]);
            for(int j=0; j < 8; j++) {
                int index = i * 8 + j;
                des[index] = trans[j];
            }
            //处理图像镜像显示问题
            if(i % 5 == 0 && i != 0) {
                //5个字节/40个字节 为单位取出一行
                byte[] line = ArrayUtil.reverse(Arrays.copyOfRange(des, (i - 5) * 8, (i * 8)));
                System.arraycopy(line,0,des,(i - 5) * 8,40);
            }
        }
        return des;
    }

    private static byte[] transImageBitsToBytes_2(byte[] src) {
        // 把byte[]数组转换为bit数组
        byte[] des = new byte[src.length * 8];
        for (int i = 0; i < src.length; i++) {
            byte[] trans = transByteToBitsArray(src[i]);
            for(int j = 0; j < 8; j++) {
                int index = i * 8 + j;
                des[index] = trans[j];
            }
        }
        return des;
    }

    /**
     * 将原始二进制数据转换为图片并输出
     * @param source 原始数据
     * @param imagePath 图像保存位置
     * @param imagePrefix 图像名称前缀
     */
    public static void transferBytesToImages_1(int[] source,String imagePath,String imagePrefix) {
        //使用gzip算法解压原始数据
        byte[] unGZipBytes = ZipUtils.unGZip(ZipUtils.intArrToByteArr(source));

        for(int i = 0; i < 5; i++) {
            //获取每个图片的字节数组，一共有1000个字节，每个图片占200字节，共有5张图片
            byte[] srcBytes = Arrays.copyOfRange(unGZipBytes, 0 + (200 * i), 200 + (200 * i));
            //获取还原后的字节数组
            byte[] desBytes = transImageBitsToBytes_1(srcBytes);
            //合并bmp头和bmp内容
            byte[] bmpBytes = ArrayUtil.addAll(ZipUtils.intArrToByteArr(BMP_IMAGE_HEADER_1), desBytes);
            FileUtil.writeBytes(bmpBytes,imagePath + imagePrefix + i + ".bmp");
        }
    }

    /**
     * 将原始二进制数据转换为图片并输出
     * @param source 原始数据
     * @param imagePath 图像保存位置
     * @param imagePrefix 图像名称前缀
     */
    public static void transferBytesToImages_2(int[] source,String imagePath,String imagePrefix) {
        String hex = "501E000000000000005003800A41E802000000000004001E80CA3E000000000000004001800C01E000000000200000001E80C81E003000000000000001800C49A001000000000000023820E03A003000000000000001800A01A0010020000000022A9200881A0010000000000000018008A1B0010000000000050A1800881B001000000000000001800A81B02100020001000E803A20803B001000000000002003800A41B0010000008000038A3A20A81B001000000000002803800201B00100000028000AC23800003F001000000000000801800001F001000000A0000E883A00001F001000000000006801800001B0010000000A0002881AA0803F001000000000000401800801F0090000000A80A2881F80801F001000000000006001800801F001000000088A86A80C80801F001000000000006800880801F0A100008208000E880D80201F00100000000000A800880001F001000002A0000A880C88001F001000000000008800C80001F001200000A0000A880D80001F001000000A00000801C80001F00120800A202002881C80001F001000000000000001880001F001200000220002881E80003F001000000000000081800001F009220000000002881BA0003F001000000000200091A00001F009200000280002A81B00000F001000000000002001200001F009202082882023A81B00000F001000000000000001A80000F029200A000008A2A80E00000F001000000000000000C80000F021200002200002800C80008F001000000000002801880000F0012A8020080003E018C8000F001000000000004001980400F0092000A2800002801980008F401000000000004001980000F02920002000240EA81900000F00100000000000C000DC0000F009000A8380000AA80DC8008F001000000000002000980000F00922008FA02802A809C8000F0010000FD000000000980400F0012AA02F000006802A08000F001000002400006800D00000F0210000A2002800000C60000F001000000000000000BE0000F00100000AA00A00001B68000F001000000000000001C00000F001000080020A02000A68000F001B007C00340028019C0000F001F80FCCBE8822801E40000F003F91FC01F8000001840000F039F83F821F822E841940000F039B87D07898000041980000D1F9B87C0781E0AA841800000D1F998380780F000841880000D3F9B83817807002041A80000D5E1B83C0F80E040841880000D381B83E9FA0E00A849BA0000D703B81FFFD8F0000419A0000F701F81FFFFFE0028410A0000D4019017FEFFC0001C1880000D0019807FFFF88A87018A8000D0018001007F0001601980000F001800000DC20024289A0000F001000000000010C00980000F8290000000000024009CA000F8010000000000004408A0000F2010002000000028008C2000F801800000000008001880000FA0980000000802A808CC0000F801800000000002801880000F801800028000002C098C0000F8018000000000028411C8000F8018000200000028408C0000F8018000000000020408E0000F8018000000002878488C2000F801800000000002041C80000F88180000000A0828488CA000F801800000000002140C80000F801800020008002848CC0000F801800000000002040880000F80180008BE220028488A0000F8018000DF200000140980000F80188001FA002028089E4000F801800018000000140D8A000F80180001AA8002084A88000078018000000400009424820007801800A0800020284A0C30007811800011000000041087000780180080000800A8492E68007801800010010100041880800780BC000023F200A0698E0000780FE00000FF00028418C0000780FE00003FFE0008690EA0007807F80007FB80008618C00007803FC807FE3A1020698C00207901B806FEA380005618800007B81F80FFE00C00A0690C00007A81B81FFE87C400D61C800007B80FC3FFFFFE00A9698D00007AC0FC3FFFFFDC403E188000078FBF01FDFFFFE028698E00007BFFE019107FE0001618800007BFFE0000001E2828400C0020782F80000000400604008000078A98002000000000428C000078118000000000000608C000078018200000000000608C00007800800000000003420CE00007800800000200000028CC200068008000000000000208C000078008200200002A8828CEE0007800800000000003020CC00006800820200000002828CC80006801800000000002001CC80006C00800020800A860298FE0006C008000000000060218C80006C00800002A00A848208CA000EC048000000000000208800006C008A8000000A80028E86000EC00800000000000020C8E0007C0880000880AAA80A8CD80007C00800040000000000CF80007C2880001E0AAA014A8CC00007C0080000B000000820C000007C208000A0A00AA1828CC20007C00800000400000820CC00007C00800280082A028286CA0007C008000010000000206C00007C0080001802080A82868A000FC008000000000000204800007C08C28000200002820CC00007C00800000000400820CD00007C0F80A0FF802083C20CC00007C1FE403FFC3E000820CD400079FFF007FFE3E808020CC00007BFEF80FFFE0F8004208480007FE8FC0FCFF0B8046206490007CC0FC0F807818024200C18007F60DC1F003038270A1EC10007FE0DC1E00780F078218600007DE0DC1F40FC3F24028AC00007CD8FC0F001820000208C00003CFDF80FE7FC7800421CE80003DFBF007FFFFEC000218E00003FFFF803FFFFF0824E88C00003C1F8001FFFF70020208C00003C058000363210830208C00003C008011000004008248C00007C00C0000001820B620EC00003C008000000010010248C00003C00C000200000032208C00003C00C000000000018208800003C00802200022A81EA0CC00003C00C00000000001221C400003C00C0208800220AA20A400003C04C020000000000200600003C00C0601800008A6A02E00003C00C060180000000202E00003C00CE40000000036BC2600003C00C20000000003820AE00003C00C000002808030A0AEA0003C00C000000000012000E00003C00C000002000096202C20003C00C00000000001C016CE0003C00C0022E02A02B6A02C00003C04C00005400001E202C00003C80CA0AA4802801E20AC00003D10C0000FC00001E202C00003C00CA003FE000006382C20003D00C00000100003C200C20003DF8C80A890000030208C00003C3CC000140000000204D10003C0080202244A0806200C00003C00F004004000002210800003DFEF800200082012204E00003DFEFC00001500002206600003DFEFF800000002BEA04480003DFCFF00040000012240600003C00CF883E8008006A0C400003C0047807E007900220C600003C004781FFFBFB812A0C4000034006381FFFFF881620C60000340067CBFFFFF9A0622AE80003404D7C3FFFFB981723C6100035FEDF81E3F189801A2E4000034FFFF008001078000006000035FFFE80000010016A08C0000357CFC0000040000A000C00003C38402803AC00006A00C00003C00C000000000018014C000034004220080200008202EC00034004000100000008006620003400400008E00200AA244000034004000000000008026600003400480000002880A8266800034004000000000018000600003420480000002881200268000340040000000000101006000034A0480000002281A002600003400400000000001A002600003600480800000A02E002600003600400000000000A00260000340A400000000008A802600003E004000000000008002600003C08482000200009EA02608003E00400000000001A040600003E00480000002001A20E620803E00400103010001A24E604003E004002FFE00003A20EE00003E00400028010001A00C600003E00400A0A600000B00A600003E10400000C00000B042604003E0040080A280001E21A6C0003E00400000000000B258600003E0040000002000AE00E6C4003E00400000000000620C6C4003E804008383012AA600C604003E06C40006F03000634C200003EFFFC003FF4FF00600C600003EFE7E00BFFC3E00614C600803E5A7F88FFFE1580600C4B8023E606F81FFFE14C0E10C400003E204F81E03F06C1E10CE18003E604381E01783C1E104850803E324381E0070F806104A02003E286381F01B0F9561046D0003E3E4383F01F7F80610C200003E7C67C3F7CE6CD1F104601803EBF7F817FFFF800E0067C000BE1FFC01FFFFF8006006600E03C00C8003FFF08000802208003E0060000C0C00000007600083E0040002000080060026B800BE00400000000000E002600003E806000000000001002282103E006000000000003006610003E006A000000000A00A64D8203E006000000000000003C10003E006000000000002022C78003E006040400000002404C79003E20600000000000A000AE0003E006000000000002501840403E006000200000002001BE000BE006151400105542501BC018BE006000000000002103F0000BE004000000000000101718009EFFC0003FFFFFFFFD0062000BFFFFFFFFFFFFFFFFF0134008BEFFFFFFFFFE00000002200001E700000000000000000242101F000000000000000003A04803E000000000000000002F000E1E000000000001BE07FEA20001E001F0DFFFFFFFFFFFF002001EFFFFFFFFFFFFFFFFFE802201FFFFFFFFFFFFF007806C06001EFFFF80000000000000804001E000000000000000003002009E00000000000000000E00600BE00000000000000001C007001E000010128000000018007403E00400000000000001C003041E0000000002000000E8000003E000000000000000170006801E0000000000800002A0007801E000000000000000000003041E0000000000000002A0003401E000000000000000400003003E000000000000001A00001403E000000000000000580000601E00A00000A0000038A0005523E000000000005500400004401EAAAA2A838000002200004529A000000000000001A00000E01B00000000000001080001CD0BBF00000000000011000036E51D00000000000FFE0000078703DFFFFFFFFFFFFFE000005A2B4FFFFFFFFFFFFFFF00001F8102FFFFFFFF7D080BF8000199195003FA3F8000003B00003FD1C28000000000000FA00003791E14140000000000EC00007E55D0800000000000BF400007E22180050050000001EC0001DE04142020020000023F80000DE008E8000014100007F00001F84504540800108000FE000037A0408A80400004001EC00006F041505F5800004001E800006E800020A0200000007B80000FE05011405E40009017D00000DE800000033C0000007E00001F8005855505D440020F600001780000000000080001EC02007780400401435040001F000007FA000802A000E040079000007E000000405551FC407800000DE000000001040A288F200001FC0075140050140053F4000017C000000000E000A93F80000778045554114251405FF000002F800000000000000079000005E00055555550555017800000DE0000000000000000EE000A1BE100";
        //byte[] unGZipBytes = ZipUtils.unGZip(HexUtil.decodeHex(hex));
        byte[] unGZipBytes = HexUtil.decodeHex(hex);
        //使用gzip算法解压原始数据
        //byte[] unGZipBytes = ZipUtils.unGZip(ZipUtils.intArrToByteArr(source));
        //获取还原后的字节数组
        byte[] desBytes = transImageBitsToBytes_2(unGZipBytes);
        for(int i = 0; i < desBytes.length; i++) {
            if(i % 100 == 0 && i != 0) {
                System.out.println();
            }
            if(i % 100 <= 30) {
                desBytes[i] = 0;
            }
            System.out.print((desBytes[i] & 0xFF) + "\t");
        }
        //byte[] bmpBytes = BmpHeaderUtil.createBmpFile(desBytes, 100, 320);
        // 不旋转直接输出图片
        //FileUtil.writeBytes(bmpBytes,imagePath + imagePrefix + ".bmp");

        // 把图片顺时针旋转90度
        desBytes = ImageRotationUtils.rotateImage(desBytes, 100, 320, 90);
        byte[] bmpBytes = BmpHeaderUtil.createBmpFile(desBytes, 320, 100);
        FileUtil.writeBytes(bmpBytes,imagePath + imagePrefix + ".bmp");
        File file = new File(imagePath + imagePrefix + ".bmp");
        file.setReadable(true, false);
    }

    @Test
    public void binaryToJpeg() throws IOException {
        String filePath = "d:/temp/test.jpeg";
        String hex = "FFD8FFE000104A46494600010100000100010000FFDB0043000201010201010202020202020202030503030303030604040305070607070706070708090B0908080A0807070A0D0A0A0B0C0C0C0C07090E0F0D0C0E0B0C0C0CFFC0000B0800F0006401011100FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFDA0008010100003F00FD938BC4E9AF58C4E17692BC8ED9AF8F3F6D2D3E3BEF89E85DB0D1A0C0E3A1C7F80AF15F8E7A679BF0D2F8C2A4B9B361827BF41CFD4E3F1AF903C05A0DC7D8B6E98F6B131D7036F923332346238D9C00197E631A940D92158825582ED3A7F16B4590EBB6E9E5EEF35461BA6DC6320FF3FA1AE1FC43E1490B8C29756190579C8E9C7BD62587C391ABEAAD651BC6F790C0973245B87991A39608ECBD54318E4009EA51B1F74E33BC47F09EE2C207325BF3921B9C91D7F1FF00F5D64E99E0176629B4E0AE0E4F5191C74E95D2FC4DF07795E1BF09AB827CBF0FA4781FC47FB4750240FC083F8556FD9A3C3E13E3B78206D27FE2A1B11F30E9FBF4AFE96A55DD191ED589730FEF8D71DE059D9F4E504F415F30FED992ABFC5B519CFEE9723E98E7F9D7967C566F3FC13346CA496B6C0541CBE3A63DFE95F20FC1FB86974892592350B0EBED1A6DEF9B6C77F4C67F3ADFF89724F2EA7648224FDEE4A328F98918047D3047E75CC7C3DD0EF7C73E3CD42DACB4A96E34E92479135587528EEECDA58F64125B79664DF04CB2C52868E38CC4363317123BA0F56F05FECC89E08BA6D4274B9BAD667D3ADB4FBBD42E08125E45034AD19654C44ADBA7958EC4504BF4C05034756FD8A752F89A60D66CA7BDB76B0F363304537EEAED1939596339040608CAEA03A94C060AF22BF03E13FD996F35DF1CCBA5C51342D16412CA0371FE1EB537ED2DFB3A6A1E0CD3346B795249BEC5A5AC2F2850437FA45C381C77C3E3F9579FFECAFE0B96E7F686F0545247864D7EC8BAAF2389949E7D2BFA166E41AC9BA8C998E05721E0FB031588CF5C7435F2DFED93A2CB3FC5546DC13E518F5C7F9C7E95E61F133445BBF0E95937106065393C118EFC8F53DEBE63F00595AAD8156B5B981AEFC42042B1DBBC8246FB1B92F232AED8B2223967C2EE2A992CCA0EEFC44F060BEBAB762C2396DDB31E13716CE3E5FF0039AF5AFD947E1EAE9BA5C4B737126A37D676E913CF30459AE0AAA8F31C46AA818F521555724E001C0FA37E187C265F155ECF35F46628C290991FE7D6A3F0C7C2ED5BC05E2CB84F3C7F65B312ABDBFCE3FCF15E4BAAEB9A6DB7ED397C96AF083E490DB54005B1827EB9AC0FDA1FE2C69761E20B5D2F5058A586E74C8EE0B37202B4B22FE1F76BCC7E02F8234CBBF8EFE03F1068175697FA3EA5AB585CC1341209629924963DAE8CB956521B20838E98AFD9BACFB843E69C530787A3B66262E14F41E95F367ED53E19B7BDF1B077C89D634C0C6411CF3EDD2BC53E25E8A62D119579FDD1519F5C62BE59D06F27D39AE618ADA4BE5BBF10ECF3EDCA2C76A86099C970C55B6860B1FC818EE64380A1996DFC53F19C1E16D46CE7BDB882DA32E917993CAB1C6D248EB1A264F566775503A966500126A97803F6AB9FC33AE41A95BDA8874BB8B782489E679A2B8667DE5964B7922531ED5119193BB2CEACA9B416F58FF87961B386E6DED6092DA6B194432B491488198C4B2029951E6261802C9950DB949DCAC072DE37FF008294F887C43A2DD416B1491BB298D2538E33C06F5C61B3EBC57CBD27ED3FAA4BE343AA5ACA44EC060AC9BC9258E73839C918EFF80ADAF8EFF12AF3C41E1EF0BEA33BAC92DC6888A656C97DAB7B7601E4FA0FD4FB5761FF0004ECF1A4D6BF1C7C19610C8C9617BAE5962CD238D208666BC324B32E10319257949725882541003162DFBC354EE14994E2AD93815F3E7ED396A25F16DBB151931819CF246E6FF3F8D786FC5E1159E8721C70B1331CF39C0CFF004AF917C11613E9F7F7CB87529ABAB1121DFB90C528EBE991C7D4566FC6BB8369AAC0AA72D2A93B49E7031FE35E4CFA76A3A7786EC2DAF6F4EADA8D9D9C69797A205805D4AA80493796A76A6E605B68E06EC0E95C878C35DBCFB4811EF46F2C2B85E030EA4FAF4ACABCD5EE4411A2970D036E53CAB0FA77AC08AC0C7783F70C8A1B861DF9E3AD75FF0014EE5E3F03F84305594787233B339603EDF7D827EBFCEBD27FE09D37BBFF006A5F86B19002CDE23B250BCE46274209F6E0D7F40D556E01329E7159DA36A4D3DB265891B78C9CD7877ED3DA8A2F8CAD41601D61FE6C7FC2BC4FE2F2A49E1E95DB24BC0EBFF8E9FF00EBD7CD3E139BFB0F509DE386DE568EF56393ED11F9892068E753C1EF9E6B80FDA9A39DA782CF4992E5355BED3EE3EC9318D922864554505A7314B1A36E914A878DC9C3911C8118561691E09B9BC4737AF6F3B1964606085A20B1972635C166E4215566CE1994B0550428D4F047ECC52F89F4809A9EA37B2DDB4905C48D6D6F145165162F3238D1D646586528E48777917CE70B20C214A9F133F66A874D2BE4DA5C7948581554E429C005703A83EB9CE6BC523B2D3358FB45B69F7D67A8369572F6374F04AAED04C87E789F693B245DC3721E471915B9F143C16917867C26AC92A81E1A8573D79FB75F1E0FE39FA576FF00F04F4D03EC9FB56FC2E1962C3C4966C47FC0C64FE78AFDF9AAF3A9321AE5FC3121FB0C40E73B45787FED39A7CFA97C47B64894B6615E41E9C9AF2CF88B698B148653D41047A1AF95515AF257922BCBAB74B2D62169D516365BB060B95F298B293B41757CA156DD1AF254B2B58F8B7E045F1B587D8E5F3847711B472182778260197194910ABC6DD70CA4303C820806BD0FE10FC09875085AE6E87EEA200636FDEE3FC3B7BD7BFF00ECDDF09F45BBD767825843A84C80471C741F4EBC577FAEFC39F07DD6B73E966CE0375B0E7E5FF22BF3A3F69BF84F1D9FED0CBA6693A55C5CC33DEEC90C2500B55D8CDB9F24332928170A19B748A71B7730F5EF885FB2678575FF000B69B7175A6DB47A9D95A49616F74611E6C50BB9768D5B19556215880402514F5504717FB2F7ECD973F0EBF6AFF005CC599ACE2D72D9C305E17122F524E7AD7EC0D4537DFAE7F47D2E4B285518302A31C8AF12FDA5F46B8B8F1A453C0CC0C56EAEDB4E0800B73F9578DFC50F9EC2DFCCC92D90719CF6AF95ED2D5BFB33520AAB114D6E11B40C1DBE54D83CF6FF000ADFF186B9FD957B65BB1B5F8C83C93F4AF5EF821F17B45F24D9DF4C90961BB938007F4AF72F087C53F087812CA4BB82E6269594B00ADD4E381F8D7911FDAAF4C87E2FDCDFDE4FE5DBCB1B80C3271C9E83D3A7F9E9E037BFB5E786353F8DB3F8974F92D754D2B50025B7B942B2C57119552AE8EA482A41C8232083C67AD7B17C4AFDA9BC316FE16D3EE2718FB5A19635247DD05D73C67BA11FFEAACDFD98BF687D17C75FB44F83F4EB3E5E6D5A05520E46778F6AFD3AA8E500B75A59A20E327B57CFDFB4BC662F175B6E0C5248400474E18FF88AF0FF008D393A119154030C5213938078073F862BE41F0A595F5BDD789DAF7527BEB7BDD72DAE2C6336CB17D821FB29430EE1CC9995659373723CDDBD141AE73F6AAF2F5FD5BC33A74B1DC32ADC4D74F2C7BE06862FB2CD6CE63B858D8C5366EA30BB2486523CC6572A9223F1DE05FDA56C7C71E24B1D1F4D8F555D4AEA365B8325B9234C9FCFB880433BA928ADE75A5DA0752D1136E4799FBC87CDDEBAF899A842CD099FC89016494646EDE0F3D3D08ED919AE4FC53E3A967B77796679CED081CF3C035C47F6D3FDA636055255258C858E5813C7BF1CD743F1BBC4D3FF00C213E1555936E7428846463E5C5CDCEEE0F3C81D3D6BD17FE096DAAC979FB63FC3C4692460DABC1BBA7AB11D3E9FE715FBCB51CC486E3D2A9C3AC2DEC4ACA36E46719CD7CFBFB536A1E478DF4E53D3CA27DBEF578A7C6897EDDE1F0A3070AC429FA0AF96FC23776F39BE4B9252DA3BF89D5D50169728D9C7E6719EF9AA5F1D7C40D6ED691DB2DA0B694949A3B88C399D71D0F3C01C74C1CE39AF0DB1F1458F8F7C45A78D2E1BEBCB1934BB8B84BD115EA594B199E244284C7F669B798D995CC9BC47B5E30F14CCF5B907C2FD6359666B7832A9F2943C741D47B7BF7FD2B075FF0087FAC68DA8C56F73A532E9AF69348D7EF3A8114C8D0AC71797F798389246DDC05F2707EF2D7153E8225D5E0549378C8195E33D88FF003EB5DA7C5EF047F69F86BC3B0A36C36FA3C6BB5B2327ED173F860E48CFBD75BFF04AEB09AC7F6EAF86B13A94035805BA12088E4C29FCC9FC057EFB5452E77F7AE57C313EFB288F5F907F2AF0AFDAB2EF6F8F6CD09C7EE38F5EBFFD7AF18F8A8E64D10145919829E01FBC723B7E75F26EA0D058EB309D3AE3538FED5AEC3049690DBF9E8E45ADC9F2A6608FE5C5F2EF570D1FCEB1AEEF9B63BBF686D22F60D3AD6EAC74C6D5A4B724C91477022B80823720441F11BBBC8B1A61DE350242C5C6DC1ADA4E8AF3460793E748C7015509C7D47FF5EBD33E1E7866488B1922442E9B8F1C8FCBA526A5F0B751F893ADC7A5D943B6E1C9652060271D73F8D79278FF00F643F107867E24AE94D6F1496B3C4DE6912159BCC2536854085190832E49652A554053B895F4AF12FEC5BAA6ADA068EF248E26B3B25818395C362591B041FF007FF1ADBFD82FF64ED4BE1A7ED55E0ED53519D6EE68355621D23F291622EE635DBB9896542AACD9F98824050DB47EB7D31FAD72DE1AB5305A4408E5540FD2BC3BF6A6D30DEF8FAC1F6FDD873C1F527FC2BC77E23583C56B19F2CBE013819CFE18AF91BC016D71ACDFF89F5276B8B39A1D5E0B5FECFB830288BC95B955B84299666991D1F0CE48554F911BCC07B7F18BA7DA2C4143B2403793D88C76AECBE194DE12D175654D4044EE1449D7E553DF38FE5FA77AFA2FC0FA07C3FF0019E9E8D1CB6E8CE31B87AFBFD2B7BC2FFB37E9BE1EF16C5A9E9D7893420B1C64923AF039C01CFF002AF2BF89779A7697FB4D470DEBC6B1B00172401B86E1CFD47E14BF1D6DF57BDBB8DF4ABA115AADBAE42004BBEF39C93FECE3F2A5FD9DB549ADFE38F82ED6EA58DAEA5BD52C17BE11B27F43F91AFBE298FF007AAB26909091B3A0F5AF14FDA0F4A59FC610B1E36C0171F89AF06F8CB18B5B01C17F95B0319E38F4E95F1B785B49B6BCF136AB72F6D05E5CC5AB5BDE06BE5338B19CDA496E5E0DC4F927C938FDD8507CD9091991C997E3D78AAE741BEB6B1B6BDB0B5D52F2D2596C52E236B83F2B22B4E6157469228DA48836D65FF58A0B2EE06B0BC45F10A4D03439EF1629EFE68E132C70421035D30E90A977450CDC01B982F3C900122E695FB4F4DE0B7BD8AD6DB50BCBAB4B61731DB42368B8043ED8E292429119098C8DA5C6DCA16DAAE09EA66FDBB35FF08E9A5EC6FE5762A49F9C32E49E01E4E0E01E39FC2BC87C4DFB5B6B5E26F88D71A8DF4C929088D0CC243BCB1672CAC81405551B304392C4B655700B7A3F8BBF6D9D4BC2DE0FD1A392EE566BAD35276254E5D8C9229CF078F97D3B574FFF0004D6F8E9A87C5DFDB5BC2EB2C91CB6714EACB2AC8FBE490C736F53195002851190C0924B1042ED05BF632A391F0D4E12A93C303F4AF12FDA0F5058BC4B1C7C1261C907EA71FD6BE73F8D376134794E3CC6DA7E53D08C80476F5F5AF8CF4ABED4ACFC67A85ADB59C6D026B504D777D2CCB1AEC78EE8148D417677468A1043845DB2EE5772A52A7FDA622D4BFB7FC3B716D234B66864B6B9B4322AAB6E5DE2603CB6667468D102EF45C4EEC7715415E59E21F135878BAC6CB55D12FA79A09A1961F2CC2A8BBB7609995D04A9342E8E8632576B3C8AEA5946DCAB9334F6F23492A896048D849C2A82464F03AFE02B9CF13EAF3E7CA89CB4430C580DA471DC7E38C5733F6AB8B49837961958FDDCECCFB671C56F7C6FD56597C2DE14999516593C356CD222640526E2E73D7B67F957B47FC116F5A95BF6DFF05C2A4F96F79286009C31F224E7AF6007EB5FBD7514DF7EB9EF0E6A466B38DB279506BC57F692D531E3A823C64FD9C13FF7D1AF9FFE35DD81A5C636B39937FCA07231B7A57CAFE1AD33533AAF89AE0985611AFA471136CC8C91F904ED6DCCDE61DECF8650A30C171F2EE6B9F1E27161AF6845031B9BCBA36B1C82D9E554251A42CECA084004670CF81B8AAF2CCA0F1FFF00084C7AB5A2452457577B2407723EC4CE71DBD073F8D74FE17FD9E2CFC451339B2B8000FB80B49B4819C963BBB76E3B579D7C6EF8356BE0CD5AC228F4EB96B6BD32A99889A56864037202AB1955899566CC8EEA15D224018C981C127C3BB4BBB8B18CEA50DB8BD99A1B68E6DA1AE6408F2144E416611A3B6002708C7A035D7FC56FD9F2E754F0C787446D2AC76BA2436EDB61DE01134E58751D377E95EB9FF0491F81F7FE15FDB03C237F15ED85AC16D74CF730DE21F3EF63F22750907CC3E7123239386011186D04865FDACA8277C495C9784A329611039C85EF5E37FB46DAC7FF0009FC734B3280B02A88D5BE73D79C7A57CFBF171FFD57CE5546E62C7B0E2BE62F04F896CAD343BF9ACAFCDF5A8F1648920FB6B5D343266513C1BDD8E424A24511E711E3600A1028EA3E22C70DEEBD043E6B3A380C554E0BF5C8618E8319E0D7B77C1AF863A6DB784219E780493DC7CC18E41419E00E98E2BDF3C01E01F0EF80FC3697375A7C7219C6F65080F27E9EC066B1BE2C7C1AF097C6EF055EAC36096D3C31B14609820609C7E38F5AF9A3F669FD9A746D5350BB97508D6E534B631842739C9CFDECF38C75C57A7F8AFC27E18BDBDB4D2869B0F97F6557886CFB832F800FE04D1FB2BE87A57873F6B9F0D69F6566892C734CDE688D46710499E47D2BF41AAB4E7F786B2B4ED124B2B64DE02F1C8F4AF01FDA5501F88400EA2DD7F99AF9E3E3448F6F648C40C61C96C818E99EF5F23594D3B0D4E29479701F1521560F90D98086C7A60E2BA7F8B9AF3691E20B46508833F293DB91C715ED5F01BF695D2F43B08ED75471B17072172483DFE9EB9E95F4AF87BF6ACF026B7A1A4173730EDDBC2B30E9D8F06BCF7F681FDB83C27F0D7C0973168314B7775772A5A471DB42F331795C46BC20660B96196C61572CC428247CC3F0A7F6B8D6BE0A7C44D474FF001A68EFA2C37B217B7F315D1AE220AA59F05140C3EF5014BAE021DC0B6D5F4EF891FB63F853C396D677C231E6CF68B2C43079425F8C80481956F4FD2B57F609FDA4745F8B7FB5C785E2B7785AF266B903664F4B694FA631F8F5AFD33AA7727331AB53102339AF9C3F693B68DFC72B207CB7D9C0C7A726BE69F8F97EB6BA2855E5CAC9B4E3E61F77A1FC7BFA57C6D6DACB5F24B3286FDE788E3E37E71B600724F3D7A9AD8F8E5706D75CB52D229565270092DF7B193F80FE75E7BACDB5AC1E1E5D1AD60FB169B0DA8B348AD09B4F221DBB0244D19062DABC294DA570304102AB5FFC5DBEB15318B89D1B395DB26F1C71DF800FF4AC2F187C4CBCD5151A29AEB7A9528FBC234655B72E36FA1008E6A978DBE3CF8B7E2EEAFA75C78C3C4DAB788A6D22DDADAD0DD98C7D9E2660CE1422A8C921724824ED519C0A67C66F1EC7AFE89A05CC0D711C2346862FDF44F0365679D0E0380C54B02430E1976B292A413EE1FF000456F154777FB7B7826D4484C8C6E8A82090C3ECB2EEE7D738FCEBF782B3EE4E6635564D645E8DC8D9523802BE70FDA3753DBF10E75DD86581319FA1AF9ABF685BC867D0E42EF701C46D8118055B9190DC8E300F4AF8F7C3CB39B29DA78A3412F8906DC7208FB322EEEA4F2437E75BFF001E646B9F10D9370CAA8429E0679C9FAF6FCCD71FAADB1BC81080E0B7527183581ACF80E7BC96C638E2BB964B998C184B7775042B3E59802235C291B9F0BB8AAE7732835078340F0BC77325BCEAB344B71099ED9EDE5DAC323723857561900AB00C0F0403C57176969E76A323B00540249030B8C85CFE66B4BE2E787EE0F857444B89ADE69174A46436F11882C667B8D89866624AAED04E4062A48550428F68FF008225680D67FF000508F0333820A35DB0CFFD7ACC08E9FEEFE55FBEA4E01ACAB97C4C79AE63C312B1B08F39C8503F4AF9F3F693BA0DF136719E90A0E3BF5AF9CFE3893F6655DCB8689BEA33DFA7B7FF005ABE4CF095A4F05BC71CA666CF8A33F3E41DBF674C75E831823FFD75B3F17C43378A74B59AE23825BA7FB3D9C4EEA8D3B8569192307966D91B39039DA8C7A0ACAD3BC11E2EFED789A69B44BFD364BB9CBC69692DACD6B6E5418086324AB2C8ACACAFC461C4A186C31EC97B4F01FC3ED5340F0669F06A37CFAB5FDBDA4515EDFF00D985B8BE95540797CB5CAA6E6CB6D0485CE2B3B56F045E78C6FC58DBC3E749282AB93D0D709E3FFD9E352F0BF8812DA58BCA9AF086500647A91DB9CF3CD763ACFECB57FE26F0AE8B36F8A33069F140E6443BB2AEEC78EDF7BD7F0AF5CFF82617ECF52FC37FDB5BC137F2344ECAF74A7629E375B4DDCFD057EC2487087E958B72E7CE3587A3DB3436880F042F35F387ED17193F12AE24DA4A08D549C719E78AF03F8D09147682791582F97804374F98E78EFC1FD6BE49F0AF8860D674AD1F508A786EAD6FB5E6BEB69E060D0CF11821C3C6C38642B27046456BF8E3C5C62F897696C001696F6A2E279A5591046C64FDDAC7FBBD926424A5C093747B63CA912823D27E187C4CD1BFB4A08EE9D1B77DDC67AF20F6CF6FE75EFF00E1EB1F0A78CEC804FB38690101BA36707A7D299E1FF80D69A078D62D42D994C6838C9E47E983D05715F1CED34E7F8A3650DDF941542039E3AFDE24FD3D7D2B13E3FDAEB377A13C3E1DBAB6B299ADD96392588CB14729DDB5991594B283B4950EB9008DC3AD75BFB05EAD25AFED57E07B5B89374AD71709C9CB1FF449CD7E9E5C1C42D581732666356751B18ACDB11A6063D6BE42FDA52ECFFC2D1B88FCCE4A65507B1209FE5F9D7CEFFB41492C5E1F9C82BE6188EDE70C7078FA0E4F3ED5F24BEA93409A64134CEEB67AD5D429B98B08D7C8B57007D77E700756359DF17F589DBC4AF347349B5D0B22A82BB7B7E271EB5E6F7BE36BFD3EE19CDCCA5A471F3390C1474C8E3DBB63AD74F65FB636ABE15B578CDE5E1922C10DBFAE401C13BBBFA8E013D7A0EC7C0FFF00051EF11F866CCCF2EA8D2C2C3112020976C1240E7DB9F723D6B8EF19FED95AE7C40D5EDAFAE352F3F508638C4F34107D9E232F05CA217764048C85DCD807058E335AFE35FDAF75DB58F48896E4C626D362999B600CD9693273D874E3FD9EA6BD97FE091FF16B51F1DFFC141BC00B73752DCC72C978197CC2C9181672907A9E49FEB8AFDC4BD6C406B9DBA97131E6AE6B5AB4724A42B29083191DEBE28FDA2F5692E3E2EDEB8C95507803A7241CFE42BE7AF8F1E2AB7D2342BFBFBD9C5B59D8DAC97775712361628615323BB13C2A8456249E00CD7C77ACEAD20B1B1967924333F886F24532901A58FECF6396C8E38638C01D338E949E238D5FC3FA724569AA4291DA461ADEF6E3CFBA8C8404A4D26F93738E413E63E4827736735E7BAD697E6A498136231BD703A2FD4D719E31D26686D658619237462BB9C8F9C7393EB8C115C56A1FDA51693A7C3135B1821866DAA92BB3E4CAF866CA808D803E50CC301589CB15597C3F7D7314DB155983215FBBE9C9C77EC7F2AEEF5B696E6CF44723719347B72320F23E7E47AF39FC6BEABFF8229C3237FC140FE1DAA63CA4B8BB67217927EC53F04FA71C7E35FBE7AA36DB7AE62E65FDF1E6B98D135AFB55896672491EBC9AF8B7F69BF17CFA6FC5FD652D63F34646E6EA236EF9FA8E95E1BF153EDDE31F086A7A48B682FADF5AB66B59612AB22C909CF99148ADC147505581CA90D8391915E23E10F07F8BBC47692DA5FF00C395D66F2DE579EDE5D460DD043B96356553B867213278FE6056CEB5A6F88FC35A5DCDCEA7F06B48BD4B385EE08B2B21712C8AAA49548954BBB71C2AA9624E00278AD6B4D127B341E77C11D24AB285277C1193EAB831B63F3A4BDF0BD86A36F2B4FF0001748BADA7254B44FB8E7AFF00A9EB5C2EBFE03F0CDF78A544FF00B37C06E6D2D7EF4534896E5266F6816277060F778C37F0897E7807827C2714989BF67492248B8DC974EC3938C0C47923EB8AEB341F1F695E1EB66D353E08EAB6D63A7158ACD6DF6CECD1101896DEAA14890C8BB433FCAAA720B155FA1FFE09BBE28D03C41FB6EF82FECFF0FF0054D1751816F608351BAB34410235B3B491ABFDE0AC634C81804C6B9E82BF56F5A6C43F8572B7530131E45787783FC413C9A7067B97240C7DEAF93FF6A1F8B57BA0FC45D521B7BD684C6DB4028A7278F9870493827935E77AAFC72BD8B445B76BF792E864C8F2005546485DA02E338FC8A1E3915C9E97F1DB5DB4FED0B68EEADF56D66C8497E2CF4D58E19E7B67693ECB1849A42159846C81D9951DD5CFC8010BE89E28F186B3A0EB8F611EB90EA3F6754CDC411A79659A3567504839DAC4AE7D54F03A55BD23C71ADC88C45E1E7927CB4E3FF1DAD7B7F196AEB1022EB0DEBE5A73FA551D77E26F882DA03E45E2E71FC504679FFBE6B969FE3778A2DE5D8D3DACA08E43DB2633F8015CDF8E3F6AAD77C1518D4AF8E931695046C279BCB769CCC5E348628E144265690B3280ADBCBF968A8E5FE5F70FF8277FC6CD43C7DFB51F81E4312ADB6A4D2BE25B57B79D15AD6465DC8E03A370015650C324100835FA75AFBE16B8FBE9BFD20F35F38E9D10D36C9C26A56373B47DE865DEA7F4AF82BF6AB867D4FF00685D56FEF24D3EEECEC043269893BC723DB5CFFA42CB2A298F72131CC89BBCD6DCA5942478632F1163AA4933299244F932383BC052C491CF53927F134CD33C7979E07F13224910874B9A4B48EDAFDDA0885BCEEF380ACEF3067DCE2DA35458B3BE74C19033F93D9E97E2AD4F54F326D461863BA96797849CC80A798C11C928A77326D665C6159880CC06E3D1D8F880C0400FC639E78ABADE36C204CAF1D79ACFD4BC5DBA1EA3AE339AC5B8D652E19891F31EE2B97D73E22681A46BFF00D9579AD69169AAC91473ADA4D791A5C18E499608DF613BB6B4CCB1838C1760A3938AED7FE08DFF00116E3C65FF00050596D64BC5BB8AC3C47A859A24767208ED9ADAC955879E2EAE21E52E2DF0805BB6F4B82610DE6EDFDA0F10CB82DED5C56A137FA53738AF37B2FD8DB50B284AC7AC230EC0DA37FF00155F3C7C4AFF008233EB5E2AF1D6ADACE9FE22D3AC9B589C5C5C05D2FE69A411AC61DDB782CDB238D7272708074031CF2FFC1167C63660ECF12E9F26EEB9D3C8FF00DABC567F86FF00E08B7E3BF0CD94B03789A2D443DCCF7024BA88BC882599E5F2C1F33844DFB107F0A228E719AB9E19FF0082276B571E35D4F52D435FB8D2EEEFF4C9ED63D4A190DD4D62E630A9E4453B490C2A5D6277548C2C86152E1881505CFF00C12F7E245AEE027D36420F0551803FA9AA737FC133FE2622E7FE25B213EF22E3F43587AFFF00C130BE28EAF756A64942DAC043B5BDBDCC90A4AEB2C7223B32C7E67CBE595D81C23AC8EAEAE08C665B7FC12E7E20689ADEA1A9DB681A241A96AE23FB75D411B24F77E5AED8FCC711867DAA485DC4E07031599AB7FC1363E20AC971BBC2FA4CDF6ABB8AF2E3721FDFCF1797E5CCD98CEE913C98B6B1E57CA4C11B463D8FF605FD93FE217C32FDAC3C33ACEB5A25BC5A65A8B813CBBD98C5985C02B951CEEDA3E84D7E89F88E7019BDAB87BE9B372C726BD6E8A28A4DA3D05359233D42FE550C91C27F857F2A81A383BAAFE5513C700FE15FCAABCB15B939C28FC29893416AE1C019158BE22D5830639E4D71B777999CF35EBF0EAA180C91528D4149A0DF0C76A63EA181D6A0975027BD4126A079E6A193503EB55E4D471DFA557975223BD55B8D5827F1567DDEBD85383587AAEAC66CF358B35E7EF0F35E9967AB6E5C835723D473DE9FF6ECF7A0DDE7BD46F73514971EF50C97191C554B8BA0BDEA8DD5F9F5ACEBBBF393CF159B757D9079ACEB9BA2CC79AA2D3826BFFFD9";
        byte[] bytes = HexUtil.decodeHex(hex);

        try {
            bytes = ImageRotationUtils.rotateJpeg90Degrees(bytes);
        } catch (IOException e) {
            throw new RuntimeException("JPEG图片旋转失败: " + e.getMessage(), e);
        }

        FileUtil.writeBytes(bytes, filePath);
    }

}
